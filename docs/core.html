<!DOCTYPE html>

<html>
<head>
  <title>core.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="models.html">
                  models.js
                </a>
              
                
                <a class="source" href="views.html">
                  views.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>core.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * @file
 * Archibald Curriculum JS application core.
 *
 * This defines the core class that initializes the application. It can be
 * considered as the "controller" for the views and models. Note that this file
 * is written using Docco syntax. If Node is installed, you can generate this
 * documentation by running:
 *
 *   npm install
 *   npm run doc
 *
 * This will generate the documentation in the docs/ folder, in HTML format.
 */</span>
<span class="hljs-meta">
"use strict"</span>;
( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> $, Backbone, _, Archibald </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="templates">Templates</h2>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This defines the default templates used by the core application. They
can be overridden in various cases, as needed. Archibald Curriculum strictly
adheres to <em>BEM</em> notation for the markup, and overrides should follow suit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Archibald.templates =  _.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>CSS rules.</p>
<p>A template for the dynamic CSS rules we inject for the responsive logic.
See <code>ArchibaldCurriculum.Core#activateResponsiveLogic()</code> and
<code>ArchibaldCurriculum.Core#resize()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  css: <span class="hljs-string">'\
#&lt;%= id %&gt; .archibald-column__wrapper,\
#&lt;%= id %&gt; .archibald-column {\
  width: &lt;%= width %&gt;px;\
}'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Main application markup.</p>
<p>This defines the main application body markup, which will be injected into
the DOM wrapper that contains the application.
@todo</p>
<ul>
<li>nano classes?</li>
<li>IDs</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  app: <span class="hljs-string">'\
&lt;div class="archibald-curriculum-ui"&gt;\
  &lt;div class="archibald-curriculum-ui__row"&gt;\
    &lt;h3&gt;&lt;%= typeof editorLabel !== "undefined" ? editorLabel : "Editor" %&gt;&lt;/h3&gt;\
    &lt;div class="archibald-curriculum-ui__item-info-wrapper"&gt;&lt;/div&gt;\
    &lt;div class="archibald-curriculum-ui__editor archibald-curriculum-ui__row"&gt;\
    &lt;/div&gt;\
  &lt;/div&gt;\
  &lt;div class="archibald-curriculum-ui__row archibald-curriculum-ui__summary-wrapper"&gt;\
    &lt;h3 class="archibald-curriculum-ui__summary-wrapper__label"&gt;&lt;%= typeof summaryLabel !== "undefined" ? summaryLabel : "Summary" %&gt;&lt;/h3&gt;\
    &lt;div class="archibald-curriculum-ui__summary-wrapper__content"&gt;\
    &lt;/div&gt;\
  &lt;/div&gt;\
&lt;/div&gt;\
'</span>

}, Archibald.templates || {});</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="core">Core</h2>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The Core class is the is the central part of the application. It ties the
models and views together, and is responsible for managing the UI in an
intuitive manner. It provides many settings to change aspects of its
behavior, and triggers many events, giving other libraries and modules much
flexibility in order to alter and enhance the application workflow.</p>
<p>@param {Object} items
   (optional) An object representing the JSON database of all curriculum
   items.
@param {Object} wrapper
   (optional) The jQuery object that serves as a wrapper for the application.
@param {Object} settings
   (optional) The settings object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Core = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> items, wrapper, settings </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>We keep track of which instance we are. This is need to generate unique
IDs in certain conditions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.id = ++Core.count;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Store the settings. This must be done first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.setSettings( settings );</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Initialize the item database. This parses the raw data items and
initializes them as reusable models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ( items ) {
    <span class="hljs-keyword">this</span>.setItemDatabase( items );
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Store the application DOM wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ( wrapper ) {
    <span class="hljs-keyword">this</span>.setWrapper( wrapper );
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Initialize the column database. This will hold all column views (yes,
views) that are currently available “on screen”. This way of referencing
views using models and a collection allows us to perform actions based
on column “location” much faster than traversing the DOM. It also allows
us to cleanly keep track of what columns are available.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.columnDatabase = <span class="hljs-keyword">new</span> Archibald.ColumnCollection();
  <span class="hljs-keyword">this</span>.columnDatabase.on( <span class="hljs-string">'remove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model </span>) </span>{
    model.get( <span class="hljs-string">'column'</span> ).remove();
  });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Extend the <code>ArchibaldCurriculum.Core</code> prototype.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Core.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The identifier for the instance.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  id: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>A hash of settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  settings: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Prepare an item database. This will allow us to quickly update large
lists of items, in case of recursive checking, for example.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  itemDatabase: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Prepare a column database. This will allow us to manipulate columns,
like collapsing, hiding, showing, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  columnDatabase: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Prepare a reference to the application wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $el: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Prepare a reference to the style wrapper, used when the responsive logic
is enabled. See <code>ArchibaldCuliculm.Core#activateResponsiveLogic()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $style: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Prepare a reference to the maximum number of columns the application can
have. This is only used if the responsive logic is activated. See
<code>ArchibaldCuliculm.Core#activateResponsiveLogic()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  maxCols: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Prepare a reference to the summary view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  summaryView: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Prepare a reference to the search view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  searchView: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Prepare a reference to the item info view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  itemInfoView: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Set or refresh the application DOM wrapper.</p>
<p>@param {Object} wrapper
   The jQuery object that serves as a wrapper for the application.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setWrapper: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> wrapper </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>If we already had a wrapper, empty it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.$el !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-keyword">this</span>.$el ) {
      <span class="hljs-keyword">this</span>.$el.empty();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Set the new wrapper, or re-use the old one if none is given.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.$el = wrapper || <span class="hljs-keyword">this</span>.$el;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>We prefer having an ID for our wrapper. This will prevent conflicting
CSS rules if the responsive logic is activated. If our wrapper has no
ID, generate one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.$el[ <span class="hljs-number">0</span> ].id === <span class="hljs-string">'undefined'</span> || <span class="hljs-keyword">this</span>.$el[ <span class="hljs-number">0</span> ].id === <span class="hljs-string">''</span> ) {
      <span class="hljs-keyword">this</span>.$el[ <span class="hljs-number">0</span> ].id = <span class="hljs-string">'archibald-curriculum-ui-core-'</span> + <span class="hljs-keyword">this</span>.id;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Render the application markup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.$el.html( <span class="hljs-keyword">this</span>.settings.templates.app({
      editorLabel:  <span class="hljs-keyword">this</span>.settings.editorLabel  ? <span class="hljs-keyword">this</span>.settings.editorLabel  : <span class="hljs-literal">undefined</span>,
      summaryLabel: <span class="hljs-keyword">this</span>.settings.summaryLabel ? <span class="hljs-keyword">this</span>.settings.summaryLabel : <span class="hljs-literal">undefined</span>,
    }) );
    <span class="hljs-keyword">this</span>.triggerEvent( <span class="hljs-string">'app'</span>, <span class="hljs-string">'render'</span>, <span class="hljs-keyword">this</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Add the item info element to the markup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.updateItemInfo();</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Activate the summary logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.activateSummary();</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Activate the search logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.activateSearch();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Recompute the amount of columns we can show.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.computeMaxCols();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Get the application DOM wrapper.</p>
<p>@returns {Object}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getWrapper: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$el;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Set or refresh the application settings.</p>
<p>@param {Object} settings
   The settings hash. Will extend with the application defaults.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setSettings: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> settings </span>) </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>,
        defaults = {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>View classes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          itemView:     Archibald.ItemView,
          itemListView: Archibald.ItemListView,
          itemInfoView: Archibald.ItemInfoView,
          summaryView:  Archibald.SummaryTreeView,
          searchView:   Archibald.SearchView,</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Behavior settings.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          recursiveCheckPrompt:        <span class="hljs-literal">false</span>,
          recursiveCheckPromptMessage: <span class="hljs-string">"This will also uncheck all child items. Are you sure you want to continue?"</span>,
          useSearch:                   <span class="hljs-literal">true</span>,
          useItemInfo:                 <span class="hljs-literal">true</span>,
          editorLabel:                 <span class="hljs-literal">false</span>,
          summaryLabel:                <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Templates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          templates: {
            app: _.template( Archibald.templates.app ),
            css: _.template( Archibald.templates.css )
          },</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Event callbacks.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          events: {</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>On selecting an item, check if a new column must be spawned. This
only applies to an item that actually has children. If a new column
is to be created, collapse all sibling columns to the “right”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">"item:select"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item, columnCollection, column </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Update the item information.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.updateItemInfo( item );</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>If this item has no children, or it is “expanded”, we don’t add a
new column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> ( !item.get( <span class="hljs-string">'hasChildren'</span> ) || item.get( <span class="hljs-string">'expanded'</span> ) ) {
                <span class="hljs-keyword">return</span>;
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>We first need to collapse all sibling <em>columns</em> to the right,
if any. Simply remove them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.columnDatabase.remove(
                that.getColumnRightSiblings( column )
              );</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>It is possible some items were highlighted. Unhighlight them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.unhighlightItems();</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Get all expanded sibling <em>items</em> in the column (should only be one,
but we use a failsafe logic and treat it as an array) and update
their “expanded” property.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> siblingExpandedItems = columnCollection.where({ expanded: <span class="hljs-literal">true</span> });
              <span class="hljs-keyword">if</span> ( siblingExpandedItems.length ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> siblingExpandedItems ) {
                  siblingExpandedItems[ i ].set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">false</span> );
                }
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Get the item that was clicked and set its “expanded” property to
true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              item.set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">true</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Create the new column, collapsed and editable by default.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> newColumn = that.createColumn(
                that.itemDatabase.where({ parentId: item.get( <span class="hljs-string">'id'</span> ) }),
                <span class="hljs-literal">true</span>,
                <span class="hljs-literal">true</span>
              );</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Make sure none of its children are “expanded”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> expandedItems = that.itemDatabase.where({
                parentId: item.get( <span class="hljs-string">'id'</span> ),
                expanded: <span class="hljs-literal">true</span>
              });
              <span class="hljs-keyword">if</span> ( expandedItems.length ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> expandedItems ) {
                  expandedItems[ i ].set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">false</span> );
                }
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>If there are more than maxCols columns visible, hide the
first ones. Expand the others, as a failsafe.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> ( that.maxCols ) {
                <span class="hljs-keyword">var</span> leftSiblings = that.getColumnLeftSiblings( newColumn ),
                    leftSiblingsCount = leftSiblings.length;
                <span class="hljs-keyword">if</span> ( leftSiblingsCount &gt;= that.maxCols ) {
                  _.each( leftSiblings, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> element, i </span>) </span>{
                    <span class="hljs-keyword">var</span> column = element.get( <span class="hljs-string">'column'</span> );
                    <span class="hljs-keyword">if</span> ( leftSiblingsCount - i &gt;= that.maxCols ) {
                      column.collapse();
                    } <span class="hljs-keyword">else</span> {
                      column.expand();
                    }
                  });
                }
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Show the new column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              newColumn.expand();
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>This callback will handle the recursive checking or unchecking of
parents and children items, respectively, upon changing the state
of one item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">"item:change"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item, columnCollection, column </span>) </span>{
              that.recursiveCheck( item, that.settings.recursiveCheckPrompt );
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>This callback will handle the selection of an item and the
expanding of the editor columns to show that specific item.
Although it was originally used for the summary:item:select
event, it can also be used in other situations, like the
search:item:select event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">"summary:item:select"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> selectedItem, collection </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>First, fully collapse all the columns, except the “root” one. Get
the first column element from the database.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> column = that.columnDatabase.first().get( <span class="hljs-string">'column'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Expand it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              column.expand();</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Remove all other columns on the right.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.columnDatabase.remove(
                that.getColumnRightSiblings( column )
              );</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Construct the hierarchy as an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> items = [],
                  item = selectedItem;
              <span class="hljs-keyword">while</span> ( item.get( <span class="hljs-string">'parentId'</span> ) !== <span class="hljs-string">'root'</span> ) {
                items.push( item );
                item = collection.get( item.get( <span class="hljs-string">'parentId'</span> ) );
              }
              items.push( item );</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Reverse it, and remove the last item (we don’t expand the selected
item).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              items.reverse().pop();</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Make sure none of the items in the database are “expanded” or
“highlighted”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> expandedItems = that.itemDatabase.where({ expanded: <span class="hljs-literal">true</span> });
              <span class="hljs-keyword">if</span> ( expandedItems.length ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> expandedItems ) {
                  expandedItems[ i ].set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">false</span> );
                }
              }
              that.unhighlightItems();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Now, loop through the selected item’s hierarchy, and trigger the
“item:select” event, updating the column reference every time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> items ) {
                column.trigger(
                  <span class="hljs-string">'item:select'</span>,
                  items[ i ],
                  <span class="hljs-keyword">new</span> ArchibaldCurriculum.ItemCollection(),
                  column,
                  {}
                );</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Update the column reference, so we trigger it on the correct one
on the next pass.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                column = that.columnDatabase.last().get( <span class="hljs-string">'column'</span> );
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Finally, highlight the selected item, and scroll to it, both in the
main window AND inside the column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              selectedItem.set( <span class="hljs-string">'highlighted'</span>, <span class="hljs-literal">true</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>@todo Make this a method of the View itself!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> $.fn.nanoScroller !== <span class="hljs-string">'undefined'</span> ) {
                <span class="hljs-keyword">var</span> $element = column.$el.find( <span class="hljs-string">'[data-model-id="'</span> + selectedItem.get( <span class="hljs-string">'id'</span> ) + <span class="hljs-string">'"]'</span> );
                <span class="hljs-keyword">if</span> ( $element.length ) {
                  column.$el.find( <span class="hljs-string">'.nano'</span> ).nanoScroller({
                    scrollTo: $element
                  });
                }
              }
              $( <span class="hljs-string">'body, html'</span> ).stop().animate({
                scrollTop: ( that.$el.offset().top - <span class="hljs-number">50</span> ) + <span class="hljs-string">'px'</span>
              });
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Re-usable function for handling “go back” events.
Whenever the “Back” button is clicked,
This callback will handle the “go back” events.  Whenever the
“Back” button is clicked, we want to show the parent column
again.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">"column:go-back"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> columnCollection, column </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>It is possible some items were highlighted. Unhighlight them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.unhighlightItems();</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Remove the item info.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.updateItemInfo();</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>If there’s a previous column, show it, and collapse the last one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> prev = _.last( that.getColumnLeftSiblings( column ) ),
                  last = _.last( that.getColumnRightSiblings( column ) );

              <span class="hljs-keyword">if</span> ( prev ) {
                prev.get( <span class="hljs-string">'column'</span> ).expand();
              }

              <span class="hljs-keyword">if</span> ( last ) {
                that.columnDatabase.remove( last );
              }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Remove the expanded attribute on the new last column items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              last = that.columnDatabase.last();
              <span class="hljs-keyword">var</span> expandedItems = last.get( <span class="hljs-string">'column'</span> ).collection.where({ expanded: <span class="hljs-literal">true</span> });
              <span class="hljs-keyword">if</span> ( expandedItems.length ) {
                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> expandedItems ) {
                  expandedItems[ i ].set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">false</span> );
                }
              }
            },</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>This callback will handle the “go to root” events.  Whenever the
“Top” button is clicked, we want to show only the top-most parent
column.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">"column:go-to-root"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> columnCollection, column </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>It is possible some items were highlighted or expanded. Remove
these attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.unhighlightItems();
              that.resetExpandedItems();</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Remove the item info.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              that.updateItemInfo();</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Fetch the first column, and “collapse” all others. We don’t
actually collapse them, we completely remove them instead.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">var</span> firstColumn = that.columnDatabase.first();
              that.columnDatabase.remove(
                that.getColumnRightSiblings( firstColumn.get( <span class="hljs-string">'column'</span> ) )
              );</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Make sure the first column is expanded.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              firstColumn.get( <span class="hljs-string">'column'</span> ).expand();
            }
          }
        };

    <span class="hljs-keyword">this</span>.settings = _.extend( defaults, settings || {} );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Get the application settings.</p>
<p>@returns {Object}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getSettings: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.settings;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Activate the application summary logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  activateSummary: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.summaryView || !<span class="hljs-keyword">this</span>.summaryView.$el.length ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Pass our item database to the summary view, which will automatically
pick out the active elements, and render them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.summaryView = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.settings.summaryView({
        collection: <span class="hljs-keyword">this</span>.itemDatabase
      });

      <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">this</span>.summaryView.on( <span class="hljs-string">'item:select'</span>, <span class="hljs-keyword">this</span>.settings.events[ <span class="hljs-string">'summary:item:select'</span> ] );</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Append the summary to our application wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__summary-wrapper__content'</span> ).html( <span class="hljs-keyword">this</span>.summaryView.render().$el );</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Allow all events to bubble up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.summaryView.on( <span class="hljs-string">'all'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Get the remaining arguments, removing the event name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call( <span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Add the application itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        args.push( that );</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Bubble it up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        that.triggerEvent.apply(
          that,
          [ <span class="hljs-string">'summary'</span>, event ].concat( args )
        );
      } );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Activate the application search logic.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  activateSearch: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.settings.useSearch &amp;&amp; ( !<span class="hljs-keyword">this</span>.searchView || !<span class="hljs-keyword">this</span>.searchView.$el.length ) ) {
      <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">this</span>.searchView = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.settings.searchView({
        collection: <span class="hljs-keyword">this</span>.itemDatabase
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Add a keyboard shortcut for the search component. When a user uses
Ctrl+Shift+F, show the search field.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $( <span class="hljs-keyword">this</span>.$el[<span class="hljs-number">0</span>].ownerDocument ).keyup( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
        <span class="hljs-keyword">if</span> ( e.key.toLowerCase() === <span class="hljs-string">'f'</span> &amp;&amp; e.shiftKey &amp;&amp; e.ctrlKey ) {
          that.showSearch( <span class="hljs-literal">true</span> );
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( e.key.toLowerCase() === <span class="hljs-string">'escape'</span> ) {
          that.searchView.remove();
        }
      })</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>On cancel, completely remove the search component from the application.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.searchView.on( <span class="hljs-string">'cancel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> collection, view </span>) </span>{
        that.searchView.remove();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>On selecting an element, expand the editor to it. We use the same event
as the summary:item:select event, because the passed arguments are
almost identical. We also close the element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.searchView.on( <span class="hljs-string">'select'</span>, <span class="hljs-keyword">this</span>.settings.events[ <span class="hljs-string">'summary:item:select'</span> ] );
      <span class="hljs-keyword">this</span>.searchView.on( <span class="hljs-string">'select'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> collection, view </span>) </span>{
        that.searchView.remove();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Allow all events to bubble up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.searchView.on( <span class="hljs-string">'all'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Get the remaining arguments, removing the event name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call( <span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Add the application itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        args.push( that );</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Bubble it up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        that.triggerEvent.apply(
          that,
          [ <span class="hljs-string">'search'</span>, event ].concat( args )
        );
      } );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Show the search component.</p>
<p>Show the search component element on screen. If the <code>focus</code> parameter is
set to <code>true</code>, the search input will immediately get focus.</p>
<p>@param {Boolean} focus
   Give focus to the search input. Defaults to false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  showSearch: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> focus </span>) </span>{
    <span class="hljs-keyword">this</span>.$el.append( <span class="hljs-keyword">this</span>.searchView.render().$el );
    <span class="hljs-keyword">if</span> ( focus ) {
      <span class="hljs-keyword">this</span>.searchView.$el.find( <span class="hljs-string">'input'</span> ).focus();
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Set or refresh the global item database.</p>
<p>Calling this function will purge the existing item database, and replace
all items with the new ones.</p>
<p>@param {Object} items
   An object representing the JSON database of all curriculum items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setItemDatabase: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> items </span>) </span>{
    <span class="hljs-keyword">this</span>.itemDatabase = <span class="hljs-keyword">new</span> Archibald.ItemCollection();

    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> group <span class="hljs-keyword">in</span> items ) {
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> items[ group ] ) {
        <span class="hljs-keyword">this</span>.itemDatabase.add( <span class="hljs-keyword">new</span> Archibald.ItemModel( _.extend( {
          parentId:    group,
          hasChildren: !!(
            <span class="hljs-keyword">typeof</span> items[ items[ group ][ i ].id ] !== <span class="hljs-string">'undefined'</span> &amp;&amp;
            items[ items[ group ][ i ].id ].length
          )
        }, items[ group ][ i ] ) ) );
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Get the global item database.</p>
<p>@returns {ArchibaldCurriculum.ItemCollection}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getItemDatabase: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.itemDatabase;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Get the global column database.</p>
<p>@returns {ArchibaldCurriculum.ColumnCollection}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getColumnDatabase: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnDatabase;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Prepare the application root column.</p>
<p>This requires the item database to be set. If this method is called when
there already are columns, it will throw an error.</p>
<p>@param {Boolean} editable
   (optional) Whether the column items are editable or not. Defaults to
   false.</p>
<p>@returns {ArchibaldCurriculum.ItemListView}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createRootColumn: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> editable </span>) </span>{
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.columnDatabase.length ) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">"Cannot create a root column: there is already a column present."</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.createColumn( <span class="hljs-keyword">this</span>.itemDatabase.where({ parentId: <span class="hljs-string">"root"</span> }), editable );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Prepare a new column.</p>
<p>@param {Array} items
   The items to put in the column.
@param {Boolean} editable
   (optional) Whether the column items are editable or not. Defaults to
   false.
@param {Boolean} collapsed
   (optional) Whether the column should be collapsed on creation or not.
   Defaults to false.</p>
<p>@returns {ArchibaldCurriculum.ItemListView}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  createColumn: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> items, editable, collapsed </span>) </span>{
    <span class="hljs-keyword">var</span> column = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.settings.itemListView({
      collection: <span class="hljs-keyword">new</span> Archibald.ItemCollection( items ),
      editable:   !!editable,
      childView:  <span class="hljs-keyword">this</span>.settings.itemView
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>Must the column be collapsed by default?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( collapsed ) {
      column.collapse();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Add our new column to our column database.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.columnDatabase.add({ column: column });</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Bind our event listener, if it exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> eventList = [
      <span class="hljs-string">'item:select'</span>,
      <span class="hljs-string">'item:change'</span>,
      <span class="hljs-string">'column:go-back'</span>,
      <span class="hljs-string">'column:go-to-root'</span>
    ];
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> event <span class="hljs-keyword">in</span> eventList ) {
      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.settings.events[ eventList[ event ] ] !== <span class="hljs-string">'undefined'</span> ) {
        column.on( eventList[ event ], <span class="hljs-keyword">this</span>.settings.events[ eventList[ event ] ] );
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Allow all events to bubble up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    column.on( <span class="hljs-string">'all'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Get the remaining arguments, removing the event name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call( <span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Add the application itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      args.push( that );</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Bubble it up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      that.triggerEvent.apply(
        that,
        [ <span class="hljs-string">'column'</span>, event ].concat( args )
      );
    } );</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Add it to the wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__editor'</span> ).append( column.render().$el );</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Activate the nanoScroller plugin.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> $.fn.nanoScroller !== <span class="hljs-string">'undefined'</span> ) {
      column.$el.find( <span class="hljs-string">'.nano'</span> ).nanoScroller();
    }

    <span class="hljs-keyword">return</span> column;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Get the columns to the right of the passed column.</p>
<p>@param {ArchibaldCurriculum.ItemListView} column</p>
<p>@returns {Array}
   An array of ArchibaldCurriculum.ColumnModel items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getColumnRightSiblings: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> column </span>) </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.columnDatabase.indexOf(
      <span class="hljs-keyword">this</span>.columnDatabase.findWhere({ column: column })
    );
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.columnDatabase.length &gt; index + <span class="hljs-number">1</span> ) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnDatabase.slice( index + <span class="hljs-number">1</span> );
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> [];
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Get the columns to the left of the passed column.</p>
<p>@returns {Array}
   An array of ArchibaldCurriculum.ColumnModel items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getColumnLeftSiblings: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> column </span>) </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.columnDatabase.indexOf(
      <span class="hljs-keyword">this</span>.columnDatabase.findWhere({ column: column })
    );
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.columnDatabase.slice( <span class="hljs-number">0</span>, index );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Helper function to recursively “check” or “uncheck” items.</p>
<p>@param {ArchibaldCurriculum.ItemModel} item
   The item from which the recursive (un)checking must start.
@param {Boolean} prompt
   (optional) Whether to prompt the user in case of recursively unchecking
   items. Defaults to false.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  recursiveCheck: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item, prompt </span>) </span>{
    prompt = !!prompt;
    <span class="hljs-keyword">var</span> updated = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>If an item is selected, we must also select all its parents.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( item.get( <span class="hljs-string">'active'</span> ) ) {
      updated.push( item );

      <span class="hljs-keyword">var</span> parentId = item.get( <span class="hljs-string">'parentId'</span> ),
          parentItem;
      <span class="hljs-keyword">while</span> ( parentId !== <span class="hljs-string">'root'</span> ) {
        parentItem = <span class="hljs-keyword">this</span>.itemDatabase.get( parentId );
        parentItem.set( <span class="hljs-string">'active'</span>, <span class="hljs-literal">true</span> );
        parentId = parentItem.get( <span class="hljs-string">'parentId'</span> );
        updated.push( parentItem );
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( item.get( <span class="hljs-string">'hasChildren'</span> ) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Else, we must unselect its children. But, in order to prevent
errors, we ask the user for confirmation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ( !prompt || confirm( <span class="hljs-keyword">this</span>.settings.recursiveCheckPromptMessage ) ) {
        updated.push( item );</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Helper function for recursively looking up selected child
items.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> recursiveUnselect = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item </span>) </span>{
          updated.push( item );
          item.set( <span class="hljs-string">'active'</span>, <span class="hljs-literal">false</span> );
          <span class="hljs-keyword">var</span> childItems = that.itemDatabase.where({
            parentId: item.get( <span class="hljs-string">'id'</span> ),
            active:   <span class="hljs-literal">true</span>
          });
          <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> childItems ) {
            recursiveUnselect( childItems[ i ] );
          }
        };
        recursiveUnselect( item );
      }
      <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Because the item was already unselected (the event is triggered
after the actual property change), we must undo it and
re-select our item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        item.set( <span class="hljs-string">'active'</span>, <span class="hljs-literal">true</span> );
      }
    }

    <span class="hljs-keyword">if</span> ( updated.length ) {
      <span class="hljs-keyword">this</span>.triggerEvent(
        <span class="hljs-string">'items'</span>,
        [ <span class="hljs-string">'change'</span>, <span class="hljs-string">'active'</span> ],
        <span class="hljs-keyword">new</span> Archibald.ItemCollection( updated ),
        <span class="hljs-keyword">this</span>.itemDatabase
      );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Activate responsive logic.</p>
<p>The application is a bit too complex to be fully responsive using only CSS.
This method activates the responsive JS logic for the application, which is
responsible for calculating how many columns can be shown on screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  activateResponsiveLogic: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.$style = $( <span class="hljs-string">'&lt;style type="text/css" /&gt;'</span> ).appendTo( <span class="hljs-string">'head'</span> );
    <span class="hljs-keyword">this</span>.maxCols = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Tests show a flash of unstyled content, which breaks the resize() math.
Allow for a tiny delay before initiating the resize calculations.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Create an invisible iframe. See
<a href="http://stackoverflow.com/questions/2175992/detect-when-window-vertical-scrollbar-appears">http://stackoverflow.com/questions/2175992/detect-when-window-vertical-scrollbar-appears</a>
and <a href="https://gist.github.com/OrganicPanda/8222636">https://gist.github.com/OrganicPanda/8222636</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> $iframe = $( <span class="hljs-string">'&lt;iframe class="__archibald-curricula-ui--hacky-scrollbar-resize-listener__" /&gt;'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Make the iframe invisible, but still as wide as the screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $iframe
        .css({
          height:  <span class="hljs-number">0</span>,
          margin:  <span class="hljs-number">0</span>,
          padding: <span class="hljs-number">0</span>,
          border:  <span class="hljs-number">0</span>,
          width:  <span class="hljs-string">'100%'</span>
        })
        .on( <span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Register our event when the iframe loads. This way, we can
safely react on resize events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">this</span>.contentWindow.addEventListener( <span class="hljs-string">'resize'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            that.resize();
          } );
        })
        .appendTo( that.$el );</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Trigger the initial math.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      that.resize();
    }, <span class="hljs-number">100</span> );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Method to compute how many columns can be visible.</p>
<p>This method computes the new amount of columns that are to be shown. It is
possible to pass the expected new width to the function, which will then
skip the computing of the current application wrapper’s width. This is
very useful when using CSS animations: the JS may trigger
immediately, but the CSS is still animating. By passing the expected width,
the JS can compute the correct sizes without interfering with the CSS
animations, or having to listen to animation events, which are complex.</p>
<p>@param {Number} width
   (optional) The width of the application wrapper. If not given the width
   will be computed based on the application wrapper’s current width.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  computeMaxCols: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> width </span>) </span>{
    width = <span class="hljs-keyword">typeof</span> width === <span class="hljs-string">'number'</span> ? width : <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__editor'</span>).width();</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Recompute the amount of columns we can show. For widths less than 600,
we only show 1. For widths between 600 and 900, we show 2; between 900
and 1200, we show 3, and above that, we show 4.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.maxCols = width &lt; <span class="hljs-number">600</span> ? <span class="hljs-number">1</span> : ( width &lt; <span class="hljs-number">900</span> ? <span class="hljs-number">2</span> : ( width &lt; <span class="hljs-number">1200</span> ? <span class="hljs-number">3</span> : <span class="hljs-number">4</span> ) );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Resize helper.</p>
<p>This method computes the new amount of columns that are to be shown, and
updates the CSS rules accordingly. See
<code>ArchibaldCurriculum#computeMaxCols()</code> for more information.</p>
<p>@param {Number} newWidth
   (optional) The width of the application wrapper. If not given the width
   will be computed based on the application wrapper’s current width.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  resize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> newWidth </span>) </span>{
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.$style === <span class="hljs-string">'undefined'</span> ) {
      <span class="hljs-keyword">throw</span> <span class="hljs-string">"Resizing is only available if the responsive logic is activated. Call activateResponsiveLogic() first."</span>;
    }

    <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">typeof</span> newWidth === <span class="hljs-string">'number'</span> ? newWidth : <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__editor'</span>).width(),
        oldMaxCols = <span class="hljs-keyword">this</span>.maxCols;</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Recompute the amount of columns we can show.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.computeMaxCols( width );</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Take 1px off, in case of rounding errors (we’re looking at you, IE).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> colWidth = <span class="hljs-built_in">Math</span>.floor( width / <span class="hljs-keyword">this</span>.maxCols ) - <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Update our CSS rules by updating the content of our style element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.$style.text( <span class="hljs-keyword">this</span>.settings.templates.css({
      id:    <span class="hljs-keyword">this</span>.$el[ <span class="hljs-number">0</span> ].id,
      width: colWidth
    }) );</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Did we have more cols previously? If so, we need to collapse an
appropriate amount of columns on the left. If we have room for more, we
need to expand.
@todo Don’t rely on the DOM selector we use here!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> numExpanded = <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-column:not(.archibald-column--collapsed)'</span> ).length,
        diff = <span class="hljs-built_in">Math</span>.abs( oldMaxCols - <span class="hljs-keyword">this</span>.maxCols );

    <span class="hljs-keyword">if</span> ( oldMaxCols &gt; <span class="hljs-keyword">this</span>.maxCols &amp;&amp; numExpanded &gt; <span class="hljs-keyword">this</span>.maxCols ) {
      <span class="hljs-keyword">this</span>.columnDatabase.forEach( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model </span>) </span>{
        <span class="hljs-keyword">if</span> ( diff &amp;&amp; model.get( <span class="hljs-string">'column'</span> ).isExpanded() ) {
          model.get( <span class="hljs-string">'column'</span> ).collapse();
          diff--;
        }
      });
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( oldMaxCols &lt; <span class="hljs-keyword">this</span>.maxCols &amp;&amp; numExpanded &lt; <span class="hljs-keyword">this</span>.maxCols ) {
      _.forEach( <span class="hljs-keyword">this</span>.columnDatabase.toArray().reverse(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model </span>) </span>{
        <span class="hljs-keyword">if</span> ( diff &amp;&amp; !model.get( <span class="hljs-string">'column'</span> ).isExpanded() ) {
          model.get( <span class="hljs-string">'column'</span> ).expand();
          diff--;
        }
      });
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Unhighlight all items.</p>
<p>Update all models in the item database, and set their respective
“highlighted” properties to false.
@todo Should this really be a model property?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unhighlightItems: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> highlightedItems = <span class="hljs-keyword">this</span>.itemDatabase.where({ highlighted: <span class="hljs-literal">true</span> });
    <span class="hljs-keyword">if</span> ( highlightedItems.length ) {
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> highlightedItems ) {
        highlightedItems[ i ].set( <span class="hljs-string">'highlighted'</span>, <span class="hljs-literal">false</span> );
      }
      <span class="hljs-keyword">this</span>.triggerEvent(
        <span class="hljs-string">'items'</span>,
        [ <span class="hljs-string">'change'</span>, <span class="hljs-string">'highlighted'</span> ],
        <span class="hljs-keyword">new</span> Archibald.ItemCollection( highlightedItems ),
        <span class="hljs-keyword">this</span>.itemDatabase
      );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Reset all expanded items.</p>
<p>Update all models in the item database, and set their respective
“expanded” properties to false.
@todo Should this really be a model property?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  resetExpandedItems: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> expandedItems = <span class="hljs-keyword">this</span>.itemDatabase.where({ expanded: <span class="hljs-literal">true</span> });
    <span class="hljs-keyword">if</span> ( expandedItems.length ) {
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> expandedItems ) {
        expandedItems[ i ].set( <span class="hljs-string">'expanded'</span>, <span class="hljs-literal">false</span> );
      }
      <span class="hljs-keyword">this</span>.triggerEvent(
        <span class="hljs-string">'items'</span>,
        [ <span class="hljs-string">'change'</span>, <span class="hljs-string">'expanded'</span> ],
        <span class="hljs-keyword">new</span> Archibald.ItemCollection( expandedItems ),
        <span class="hljs-keyword">this</span>.itemDatabase
      );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Helper function to trigger an event.</p>
<p>@param {String} category
   The category for which the event is triggered. Examples:</p>
<ul>
<li><code>&quot;items&quot;</code> for the item database.</li>
<li><code>&quot;summary&quot;</code> for the summary view.</li>
<li><code>&quot;columns&quot;</code> for the column database.
@param {Array} chain
A chain of events, which will trigger multiple even variants. For
example, passing <code>[ &quot;change&quot;, &quot;active&quot; ]</code> for the <code>&quot;items&quot;</code> category
will trigger the following events:</li>
<li><code>items:change</code></li>
<li><code>items:change:active</code>
@param …
(optional) Any other parameters will simply be passed to the event
listeners, in order.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  triggerEvent: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> category, chain </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Get the remaining arguments, if any.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call( <span class="hljs-built_in">arguments</span>, <span class="hljs-number">2</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Add the application itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    args.push( <span class="hljs-keyword">this</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Make sure the chain is an array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">Array</span>.isArray( chain ) ) {
      chain = [ chain ];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Trigger multiple events, based on the chain elements. Each element in the
chain triggers an event in the given category.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>, len = chain.length; i &lt;= len; i++ ) {
      <span class="hljs-keyword">this</span>.trigger.apply(
        <span class="hljs-keyword">this</span>,
        [ category + <span class="hljs-string">':'</span> + chain.slice( <span class="hljs-number">0</span>, i ).join( <span class="hljs-string">':'</span> ) ].concat( args )
      );
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Update the item information.</p>
<p>If no item is passed, will render an “empty” item information drawer.</p>
<p>@param {ArchibaldCurriculum.ItemModel} item
   (optional) The item for which we want to render the information, or null
   to reset the information drawer.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  updateItemInfo: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Do we use the item info? If not, skip this.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.settings.useItemInfo ) {
      <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Do we already have an item info view? If not, create it now, and add it
to our application markup.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.itemInfoView || !<span class="hljs-keyword">this</span>.itemInfoView.$el.length ) {
      <span class="hljs-keyword">this</span>.itemInfoView = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.settings.itemInfoView();
      <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__item-info-wrapper'</span> ).empty().append(
        <span class="hljs-keyword">this</span>.itemInfoView.render().$el
      );</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Pass the new width to the resize function. This will allow us to
still have CSS transitions, without relying on complex JS events,
which are hard to control and could slow down the application.
WARNING: this width is hard coded!! See CSS file!!
We use the total expanded width minus the collapsed width, which
gives us the difference in width for the wrapper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> itemInfoWidth = <span class="hljs-number">270</span>, <span class="hljs-comment">// 300 - 30</span>
          that = <span class="hljs-keyword">this</span>;

      <span class="hljs-keyword">this</span>.itemInfoView.on( <span class="hljs-string">'collapse'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        that.resize( that.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__editor'</span>).width() + itemInfoWidth );
      });
      <span class="hljs-keyword">this</span>.itemInfoView.on( <span class="hljs-string">'expand'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        that.resize( that.$el.find( <span class="hljs-string">'.archibald-curriculum-ui__editor'</span>).width() - itemInfoWidth );
      });

      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> $.fn.nanoScroller !== <span class="hljs-string">'undefined'</span> ) {
        <span class="hljs-keyword">this</span>.itemInfoView.on( <span class="hljs-string">'render'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.nano'</span> ).nanoScroller();
        });
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Bubble up all item info events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.itemInfoView.on( <span class="hljs-string">'all'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Get the remaining arguments, removing the event name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call( <span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Add the application itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        args.push( that );</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Bubble it up.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        that.triggerEvent.apply(
          that,
          [ <span class="hljs-string">'item-info'</span>, event ].concat( args )
        );
      } );
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Reset the item info model, and re-render.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.itemInfoView.model = <span class="hljs-keyword">typeof</span> item !== <span class="hljs-string">'undefined'</span> ? item : <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">this</span>.itemInfoView.render();
    }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>A counter, which keeps track of how many Core instances are instantiated.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Core.count = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Extend core prototype with Backbone Events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Core.prototype = _.extend( Core.prototype, Backbone.Events );</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Export.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Archibald.Core = Core;

})( jQuery, Backbone, _, <span class="hljs-built_in">window</span>.ArchibaldCurriculum || ( <span class="hljs-built_in">window</span>.ArchibaldCurriculum = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>() ) );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
